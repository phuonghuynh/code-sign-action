module.exports=function(t,e){"use strict";var n={};function __webpack_require__(e){if(n[e]){return n[e].exports}var r=n[e]={i:e,l:false,exports:{}};t[e].call(r.exports,r,r.exports,__webpack_require__);r.l=true;return r.exports}__webpack_require__.ab=__dirname+"/";function startup(){return __webpack_require__(526)}return startup()}({82:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:true});function toCommandValue(t){if(t===null||t===undefined){return""}else if(typeof t==="string"||t instanceof String){return t}return JSON.stringify(t)}e.toCommandValue=toCommandValue},87:function(t){t.exports=require("os")},102:function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const o=r(n(747));const s=r(n(87));const i=n(82);function issueCommand(t,e){const n=process.env[`GITHUB_${t}`];if(!n){throw new Error(`Unable to find environment variable for file command ${t}`)}if(!o.existsSync(n)){throw new Error(`Missing file at path: ${n}`)}o.appendFileSync(n,`${i.toCommandValue(e)}${s.EOL}`,{encoding:"utf8"})}e.issueCommand=issueCommand},129:function(t){t.exports=require("child_process")},211:function(t){t.exports=require("https")},431:function(t,e,n){"use strict";var r=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const o=r(n(87));const s=n(82);function issueCommand(t,e,n){const r=new Command(t,e,n);process.stdout.write(r.toString()+o.EOL)}e.issueCommand=issueCommand;function issue(t,e=""){issueCommand(t,{},e)}e.issue=issue;const i="::";class Command{constructor(t,e,n){if(!t){t="missing.command"}this.command=t;this.properties=e;this.message=n}toString(){let t=i+this.command;if(this.properties&&Object.keys(this.properties).length>0){t+=" ";let e=true;for(const n in this.properties){if(this.properties.hasOwnProperty(n)){const r=this.properties[n];if(r){if(e){e=false}else{t+=","}t+=`${n}=${escapeProperty(r)}`}}}}t+=`${i}${escapeData(this.message)}`;return t}}function escapeData(t){return s.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A")}function escapeProperty(t){return s.toCommandValue(t).replace(/%/g,"%25").replace(/\r/g,"%0D").replace(/\n/g,"%0A").replace(/:/g,"%3A").replace(/,/g,"%2C")}},470:function(t,e,n){"use strict";var r=this&&this.__awaiter||function(t,e,n,r){function adopt(t){return t instanceof n?t:new n(function(e){e(t)})}return new(n||(n=Promise))(function(n,o){function fulfilled(t){try{step(r.next(t))}catch(t){o(t)}}function rejected(t){try{step(r["throw"](t))}catch(t){o(t)}}function step(t){t.done?n(t.value):adopt(t.value).then(fulfilled,rejected)}step((r=r.apply(t,e||[])).next())})};var o=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};Object.defineProperty(e,"__esModule",{value:true});const s=n(431);const i=n(102);const u=n(82);const a=o(n(87));const c=o(n(622));var f;(function(t){t[t["Success"]=0]="Success";t[t["Failure"]=1]="Failure"})(f=e.ExitCode||(e.ExitCode={}));function exportVariable(t,e){const n=u.toCommandValue(e);process.env[t]=n;const r=process.env["GITHUB_ENV"]||"";if(r){const e="_GitHubActionsFileCommandDelimeter_";const r=`${t}<<${e}${a.EOL}${n}${a.EOL}${e}`;i.issueCommand("ENV",r)}else{s.issueCommand("set-env",{name:t},n)}}e.exportVariable=exportVariable;function setSecret(t){s.issueCommand("add-mask",{},t)}e.setSecret=setSecret;function addPath(t){const e=process.env["GITHUB_PATH"]||"";if(e){i.issueCommand("PATH",t)}else{s.issueCommand("add-path",{},t)}process.env["PATH"]=`${t}${c.delimiter}${process.env["PATH"]}`}e.addPath=addPath;function getInput(t,e){const n=process.env[`INPUT_${t.replace(/ /g,"_").toUpperCase()}`]||"";if(e&&e.required&&!n){throw new Error(`Input required and not supplied: ${t}`)}return n.trim()}e.getInput=getInput;function setOutput(t,e){s.issueCommand("set-output",{name:t},e)}e.setOutput=setOutput;function setCommandEcho(t){s.issue("echo",t?"on":"off")}e.setCommandEcho=setCommandEcho;function setFailed(t){process.exitCode=f.Failure;error(t)}e.setFailed=setFailed;function isDebug(){return process.env["RUNNER_DEBUG"]==="1"}e.isDebug=isDebug;function debug(t){s.issueCommand("debug",{},t)}e.debug=debug;function error(t){s.issue("error",t instanceof Error?t.toString():t)}e.error=error;function warning(t){s.issue("warning",t instanceof Error?t.toString():t)}e.warning=warning;function info(t){process.stdout.write(t+a.EOL)}e.info=info;function startGroup(t){s.issue("group",t)}e.startGroup=startGroup;function endGroup(){s.issue("endgroup")}e.endGroup=endGroup;function group(t,e){return r(this,void 0,void 0,function*(){startGroup(t);let n;try{n=yield e()}finally{endGroup()}return n})}e.group=group;function saveState(t,e){s.issueCommand("save-state",{name:t},e)}e.saveState=saveState;function getState(t){return process.env[`STATE_${t}`]||""}e.getState=getState},526:function(t,e,n){"use strict";var r=this&&this.__await||function(t){return this instanceof r?(this.v=t,this):new r(t)};var o=this&&this.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],n;return e?e.call(t):(t=typeof __values==="function"?__values(t):t[Symbol.iterator](),n={},verb("next"),verb("throw"),verb("return"),n[Symbol.asyncIterator]=function(){return this},n);function verb(e){n[e]=t[e]&&function(n){return new Promise(function(r,o){n=t[e](n),settle(r,o,n.done,n.value)})}}function settle(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}};var s=this&&this.__asyncDelegator||function(t){var e,n;return e={},verb("next"),verb("throw",function(t){throw t}),verb("return"),e[Symbol.iterator]=function(){return this},e;function verb(o,s){e[o]=t[o]?function(e){return(n=!n)?{value:r(t[o](e)),done:o==="return"}:s?s(e):e}:s}};var i=this&&this.__asyncGenerator||function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=n.apply(t,e||[]),s,i=[];return s={},verb("next"),verb("throw"),verb("return"),s[Symbol.asyncIterator]=function(){return this},s;function verb(t){if(o[t])s[t]=function(e){return new Promise(function(n,r){i.push([t,e,n,r])>1||resume(t,e)})}}function resume(t,e){try{step(o[t](e))}catch(t){settle(i[0][3],t)}}function step(t){t.value instanceof r?Promise.resolve(t.value.v).then(fulfill,reject):settle(i[0][2],t)}function fulfill(t){resume("next",t)}function reject(t){resume("throw",t)}function settle(t,e){if(t(e),i.shift(),i.length)resume(i[0][0],i[0][1])}};var u=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var n in t)if(Object.hasOwnProperty.call(t,n))e[n]=t[n];e["default"]=t;return e};var a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:true});const c=u(n(470));const f=n(747);const l=n(747);const p=a(n(211));const d=a(n(622));const g=a(n(669));const m=n(129);const h=n(765);const v=g.default.promisify(m.exec);const y=h.env["TEMP"]+"\\certificate.pfx";const w=h.env["TEMP"]+"\\nuget.exe";const b="http://timestamp.digicert.com";const S="C:\\Program Files (x86)\\Windows Kits\\10\\bin\\10.0.17763.0\\x86\\signtool.exe";const $=[".dll",".exe",".sys",".vxd",".msix",".msixbundle",".appx",".appxbundle",".msi",".msp",".msm",".cab",".ps1",".psm1"];function sleep(t){if(t>0)console.log(`Waiting for ${t} seconds.`);return new Promise(e=>setTimeout(e,t*1e3))}async function createCertificatePfx(){const t=c.getInput("certificate");const e=Buffer.from(t,"base64");if(e.length==0){console.log('The value for "certificate" is not set.');return false}console.log(`Writing ${e.length} bytes to ${y}.`);await f.promises.writeFile(y,e);return true}async function downloadNuGet(){return new Promise(t=>{if(l.existsSync(w)){t();return}console.log(`Downloading nuget.exe.`);const e=l.createWriteStream(w);p.default.get("https://dist.nuget.org/win-x86-commandline/latest/nuget.exe",n=>{n.pipe(e);e.on("finish",function(){e.close();t()})})})}function setOutputSignCmd(){let t=c.getInput("sign_args");let e=`"${S}" `.concat(`sign /f ${y} `).concat(`/tr ${b} `).concat(`/v `).concat(`/fd sha256 `);if(t){e=`"${S}" sign /f ${y} ${t}`;console.log(`override default sign args: ${e}`)}c.setOutput("signtool_cmd",e);c.setOutput("certificate_pfx_filepath",y);c.setOutput("sign_args",t);return e}async function signWithSigntool(t){try{const e=setOutputSignCmd()+` ${t}`;const{stdout:n}=await v(e.toString());console.log(n);return true}catch(t){console.log(t.stdout);console.log(t.stderr);return false}}async function signNupkg(t){await downloadNuGet();try{const{stdout:e}=await v(`"${w}" sign ${t} -CertificatePath ${y} -Timestamper ${b}`);console.log(e);return true}catch(t){console.log(t.stdout);console.log(t.stderr);return false}}async function trySignFile(t){console.log(`Signing ${t}.`);const e=d.default.extname(t);for(let n=0;n<10;n++){await sleep(n);if($.includes(e)){if(await signWithSigntool(t))return}else if(e==".nupkg"){if(await signNupkg(t))return}}throw`Failed to sign '${t}'.`}function getFiles(t,e){return i(this,arguments,function*getFiles_1(){const n=yield r(f.promises.readdir(t));for(const i of n){const n=`${t}/${i}`;const u=yield r(f.promises.stat(n));if(u.isFile()){const t=d.default.extname(i);if($.includes(t)||t==".nupkg")yield yield r(n)}else if(u.isDirectory()&&e){yield r(yield*s(o(getFiles(n,e))))}}})}async function signFiles(){var t,e;const n=c.getInput("folder");if(n){const i=c.getInput("recursive")=="true";try{for(var r=o(getFiles(n,i)),s;s=await r.next(),!s.done;){const t=s.value;await trySignFile(t)}}catch(e){t={error:e}}finally{try{if(s&&!s.done&&(e=r.return))await e.call(r)}finally{if(t)throw t.error}}}else{setOutputSignCmd()}}async function run(){try{if(await createCertificatePfx())await signFiles()}catch(t){c.setFailed(`Action failed with error: ${t}`)}}run()},622:function(t){t.exports=require("path")},669:function(t){t.exports=require("util")},747:function(t){t.exports=require("fs")},765:function(t){t.exports=require("process")}});